<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="dmplot">
<title>Introduction to Monte Carlo Simulations • dmplot</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to Monte Carlo Simulations">
<meta property="og:description" content="dmplot">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">dmplot</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/getting-started-with-the-dmplot-framwork.html">Getting Started with the dmplot Framework</a>
    <a class="dropdown-item" href="../articles/intro-to-financial-indicators-with-dmplot.html">Intro to Financial Indicators with dmplot</a>
    <a class="dropdown-item" href="../articles/cpp-high-performance-technical-indicators.html">C++ high-performance technical indicators</a>
    <a class="dropdown-item" href="../articles/intro-to-monte-carlo-simulations.html">Introduction to Monte Carlo Simulations</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/donate.html">Donate</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dereckmezquita/dmplot" target="_blank">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://www.youtube.com/@derecksyoutube" target="_blank">
    <span class="fa fa-youtube fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://derecksnotes.com" target="_blank">derecksnotes.com</a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to Monte Carlo Simulations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dereckmezquita/dmplot/blob/HEAD/vignettes/intro-to-monte-carlo-simulations.Rmd" class="external-link"><code>vignettes/intro-to-monte-carlo-simulations.Rmd</code></a></small>
      <div class="d-none name"><code>intro-to-monte-carlo-simulations.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction-and-history">Introduction and History<a class="anchor" aria-label="anchor" href="#introduction-and-history"></a>
</h2>
<p>Monte Carlo simulations, named after the famous casino in Monaco,
have a rich history dating back to the 1940s. The method was developed
by Stanislaw Ulam, a mathematician working on the Manhattan Project, and
was named by Nicholas Metropolis, inspired by Ulam’s uncle’s interest in
Monaco’s casinos. Originally used in physics to simulate neutron
diffusion in fissile material, Monte Carlo methods quickly found
applications in various fields, including finance.</p>
<p>The essence of Monte Carlo simulation lies in using random sampling
to solve problems that might be deterministic in principle. In finance,
this approach has become invaluable for dealing with the inherent
uncertainties of markets and complex financial instruments. In
bioinformatics and epidemiology, Monte Carlo simulations are used to
model the spread of diseases and predict outcomes.</p>
<div class="section level3">
<h3 id="licensing">Licensing<a class="anchor" aria-label="anchor" href="#licensing"></a>
</h3>
<p>The <code>dmplot</code> package is released under the MIT license,
allowing free use and modification. Users must:</p>
<ol style="list-style-type: decimal">
<li>Cite the original author (see <a href="https://dereckmezquita.github.io/dmplot/LICENSE-text.html">LICENSE</a>
for details).</li>
<li>Include the license in any redistribution.</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="loading-sample-data">Loading Sample Data<a class="anchor" aria-label="anchor" href="#loading-sample-data"></a>
</h2>
<p>We’ll use the same sample data as in the README:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="http://klmr.me/box/reference/use.html" class="external-link">use</a></span><span class="op">(</span><span class="va">kucoin</span><span class="op">[</span> <span class="va">get_market_data</span> <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ticker</span> <span class="op">&lt;-</span> <span class="st">"BTC/USDT"</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">get_market_data</span><span class="op">(</span></span>
<span>    symbols <span class="op">=</span> <span class="va">ticker</span>,</span>
<span>    from <span class="op">=</span> <span class="st">"2024-01-10 22:29:26 EST"</span>, <span class="co"># lubridate::now() - lubridate::days(180),</span></span>
<span>    to <span class="op">=</span> <span class="st">"2024-07-08 22:29:41 EST"</span>, <span class="co"># lubridate::now(),</span></span>
<span>    frequency <span class="op">=</span> <span class="st">"1 hour"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;      symbol            datetime    open    high     low   close    volume</span></span>
<span><span class="co">#&gt;      &lt;char&gt;              &lt;POSc&gt;   &lt;num&gt;   &lt;num&gt;   &lt;num&gt;   &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: BTC/USDT 2024-01-10 22:00:00 45953.7 46943.4 45751.1 46899.4 598.19616</span></span>
<span><span class="co">#&gt; 2: BTC/USDT 2024-01-10 23:00:00 46899.4 47686.3 46381.2 46644.8 859.01764</span></span>
<span><span class="co">#&gt; 3: BTC/USDT 2024-01-11 00:00:00 46649.3 46710.4 46292.1 46675.8 264.78216</span></span>
<span><span class="co">#&gt; 4: BTC/USDT 2024-01-11 01:00:00 46675.8 46746.1 46473.4 46504.5 134.29370</span></span>
<span><span class="co">#&gt; 5: BTC/USDT 2024-01-11 02:00:00 46504.5 46621.8 46495.2 46562.9  88.37562</span></span>
<span><span class="co">#&gt; 6: BTC/USDT 2024-01-11 03:00:00 46562.8 46592.0 46210.6 46502.7 248.39038</span></span>
<span><span class="co">#&gt; 1 variable(s) not shown: [turnover &lt;num&gt;]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="what-are-monte-carlo-simulations">What are Monte Carlo Simulations?<a class="anchor" aria-label="anchor" href="#what-are-monte-carlo-simulations"></a>
</h2>
<p>Monte Carlo simulations are computational algorithms that rely on
repeated random sampling to obtain numerical results. In the context of
finance, they’re used to model the probability of different outcomes in
a process that cannot easily be predicted due to the intervention of
random variables.</p>
</div>
<div class="section level2">
<h2 id="uses-in-finance">Uses in Finance<a class="anchor" aria-label="anchor" href="#uses-in-finance"></a>
</h2>
<p>Monte Carlo simulations have numerous applications in finance:</p>
<ol style="list-style-type: decimal">
<li>Asset Pricing: Estimating the future value of assets or
portfolios.</li>
<li>Risk Management: Assessing potential losses and the probability of
different risk scenarios.</li>
<li>Derivatives Pricing: Valuing complex derivatives, especially those
with path-dependent payoffs.</li>
<li>Portfolio Optimisation: Determining optimal asset allocations under
various constraints and market scenarios.</li>
<li>Value at Risk (VaR) Calculations: Estimating the potential loss in
value of a portfolio.</li>
<li>Real Options Analysis: Valuing flexibility in business and
investment decisions.</li>
</ol>
</div>
<div class="section level2">
<h2 id="usage-of-dmplots-montecarlo-class">Usage of <code>dmplot</code>’s MonteCarlo Class<a class="anchor" aria-label="anchor" href="#usage-of-dmplots-montecarlo-class"></a>
</h2>
<p>This creates a new <code>MonteCarlo</code> object, runs 1000
simulations for 30 days into the future, and plots the resulting price
paths.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">box</span><span class="fu">::</span><span class="fu"><a href="http://klmr.me/box/reference/use.html" class="external-link">use</a></span><span class="op">(</span><span class="va">dmplot</span><span class="op">[</span> <span class="va">MonteCarlo</span> <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">monte</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/MonteCarlo.html">MonteCarlo</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">data</span>, number_sims <span class="op">=</span> <span class="fl">2500</span>, project_days <span class="op">=</span> <span class="fl">30</span> <span class="op">*</span> <span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run Monte Carlo simulation</span></span>
<span><span class="va">monte</span><span class="op">$</span><span class="fu">carlo</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the results</span></span>
<span><span class="va">monte</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="co">#&gt;         symbol            datetime    open    high     low   close    volume</span></span>
<span><span class="co">#&gt;         &lt;char&gt;              &lt;POSc&gt;   &lt;num&gt;   &lt;num&gt;   &lt;num&gt;   &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1: BTC/USDT 2024-01-10 22:00:00 45953.7 46943.4 45751.1 46899.4 598.19616</span></span>
<span><span class="co">#&gt;    2: BTC/USDT 2024-01-10 23:00:00 46899.4 47686.3 46381.2 46644.8 859.01764</span></span>
<span><span class="co">#&gt;    3: BTC/USDT 2024-01-11 00:00:00 46649.3 46710.4 46292.1 46675.8 264.78216</span></span>
<span><span class="co">#&gt;   ---                                                                       </span></span>
<span><span class="co">#&gt; 4317: BTC/USDT 2024-07-08 20:00:00 56475.7 56572.7 56196.8 56259.4  79.02733</span></span>
<span><span class="co">#&gt; 4318: BTC/USDT 2024-07-08 21:00:00 56259.4 56828.1 56196.7 56644.7 108.76461</span></span>
<span><span class="co">#&gt; 4319: BTC/USDT 2024-07-08 22:00:00 56639.6 56968.3 56551.3 56686.5  69.18443</span></span>
<span><span class="co">#&gt; 2 variable(s) not shown: [turnover &lt;num&gt;, historical_returns &lt;num&gt;]</span></span>
<span></span>
<span><span class="co"># the predicted prices</span></span>
<span><span class="va">monte</span><span class="op">$</span><span class="va">simulation_results</span></span>
<span><span class="co">#&gt;            close simulation            datetime</span></span>
<span><span class="co">#&gt;            &lt;num&gt;      &lt;int&gt;              &lt;POSc&gt;</span></span>
<span><span class="co">#&gt;      1: 56686.50          1 2024-07-08 22:00:00</span></span>
<span><span class="co">#&gt;      2: 56245.54          1 2024-07-09 22:00:00</span></span>
<span><span class="co">#&gt;      3: 56325.33          1 2024-07-10 22:00:00</span></span>
<span><span class="co">#&gt;     ---                                        </span></span>
<span><span class="co">#&gt; 449998: 61177.65       2500 2025-01-01 22:00:00</span></span>
<span><span class="co">#&gt; 449999: 61412.68       2500 2025-01-02 22:00:00</span></span>
<span><span class="co">#&gt; 450000: 62034.59       2500 2025-01-03 22:00:00</span></span>
<span></span>
<span><span class="co"># the final prices of each simulation</span></span>
<span><span class="va">monte</span><span class="op">$</span><span class="va">end_prices</span></span>
<span><span class="co">#&gt;          close simulation            datetime</span></span>
<span><span class="co">#&gt;          &lt;num&gt;      &lt;int&gt;              &lt;POSc&gt;</span></span>
<span><span class="co">#&gt;    1: 58752.41          1 2025-01-03 22:00:00</span></span>
<span><span class="co">#&gt;    2: 64224.74          2 2025-01-03 22:00:00</span></span>
<span><span class="co">#&gt;    3: 52629.32          3 2025-01-03 22:00:00</span></span>
<span><span class="co">#&gt;   ---                                        </span></span>
<span><span class="co">#&gt; 2498: 51928.20       2498 2025-01-03 22:00:00</span></span>
<span><span class="co">#&gt; 2499: 55719.03       2499 2025-01-03 22:00:00</span></span>
<span><span class="co">#&gt; 2500: 62034.59       2500 2025-01-03 22:00:00</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualisation">Visualisation<a class="anchor" aria-label="anchor" href="#visualisation"></a>
</h2>
<p><code>dmplot</code> provides several visualisation methods to help
interpret the results.</p>
<p>Below we plot the simulated price paths:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">monte</span><span class="op">$</span><span class="fu">plot_prices</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro-to-monte-carlo-simulations_files/figure-html/plot-prices-1.png" width="1800" style="display: block; margin: auto;"></p>
<p>We can also visualise the distribution as violin plots these help us
understand the range of possible outcomes and the distribution of final
prices:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">monte</span><span class="op">$</span><span class="fu">plot_distribution</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro-to-monte-carlo-simulations_files/figure-html/plot-distribution-1.png" width="1800" style="display: block; margin: auto;"></p>
<p>Finally, we can combine historical data with the simulations to see
how the modelled scenarios compare to reality:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">monte</span><span class="op">$</span><span class="fu">plot_prices_and_predictions</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro-to-monte-carlo-simulations_files/figure-html/plot-prices-and-predictions-1.png" width="1800" style="display: block; margin: auto;"></p>
<p>These visualisations can provide insights into the range of possible
outcomes and the likelihood of different scenarios.</p>
</div>
<div class="section level2">
<h2 id="implementation-and-design">Implementation and design<a class="anchor" aria-label="anchor" href="#implementation-and-design"></a>
</h2>
<p>The basic steps for implementing a Monte Carlo simulation in finance
are:</p>
<ol style="list-style-type: decimal">
<li>Define the parameters and inputs of the model.</li>
<li>Generate random scenarios based on the input parameters.</li>
<li>Calculate the outcome for each scenario.</li>
<li>Aggregate the results of all scenarios.</li>
<li>Analyse the distribution of outcomes.</li>
</ol>
<p>Our package makes this process extremely accessible and a three step
process through the <code>MonteCarlo</code> R6 class:</p>
<ol style="list-style-type: decimal">
<li>Create a new <code>MonteCarlo</code> object with historical price
data.</li>
<li>Run the simulation with the desired number of simulations and
projection days.</li>
<li>Visualise the results using the provided plotting methods.</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">monte</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/MonteCarlo.html">MonteCarlo</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    <span class="va">data</span>,</span>
<span>    number_sims <span class="op">=</span> <span class="fl">2500</span>,</span>
<span>    project_days <span class="op">=</span> <span class="fl">30</span> <span class="op">*</span> <span class="fl">6</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">monte</span><span class="op">$</span><span class="fu">carlo</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">monte</span><span class="op">$</span><span class="fu">plot_prices</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="mathematics-of-monte-carlo-simulations-in-finance">Mathematics of Monte Carlo Simulations in Finance<a class="anchor" aria-label="anchor" href="#mathematics-of-monte-carlo-simulations-in-finance"></a>
</h2>
<p>The core of Monte Carlo simulations in finance is often based on the
assumption that asset prices follow a geometric Brownian motion,
described by the stochastic differential equation:</p>
<p><span class="math display">\[
dS = μSdt + σSdW
\]</span></p>
<p>Where:</p>
<ul>
<li>S is the asset price</li>
<li>μ is the drift (expected return)</li>
<li>σ is the volatility</li>
<li>dW is a Wiener process</li>
</ul>
<p>In discrete time, this can be approximated as:</p>
<p><span class="math display">\[
S(t+Δt) = S(t) * exp((μ - 0.5σ²)Δt + σ√Δt * ε)
\]</span></p>
<p>Where ε is a standard normal random variable.</p>
<p>Our implementation uses this formula to generate price paths, with
the daily volatility estimated from historical data.</p>
</div>
<div class="section level2">
<h2 id="best-practices-and-what-not-to-do">Best Practices and What Not to Do<a class="anchor" aria-label="anchor" href="#best-practices-and-what-not-to-do"></a>
</h2>
<p>While Monte Carlo simulations are powerful, they should be used
carefully:</p>
<ol style="list-style-type: decimal">
<li>Do: Understand your inputs. The quality of your simulation depends
heavily on the quality of your input parameters.</li>
<li>Don’t: Rely solely on historical data for parameter estimation. Past
performance doesn’t guarantee future results.</li>
<li>Do: Run a sufficient number of simulations. More simulations
generally lead to more accurate results, but there’s a trade-off with
computational time.</li>
<li>Don’t: Ignore the limitations of your model. All models are
simplifications of reality.</li>
<li>Do: Validate your model against real-world data when possible.</li>
<li>Don’t: Forget about extreme events. Standard models often
underestimate the probability of extreme events.</li>
</ol>
</div>
<div class="section level2">
<h2 id="monte-carlo-simulation-implementation-details">Monte Carlo Simulation Implementation Details<a class="anchor" aria-label="anchor" href="#monte-carlo-simulation-implementation-details"></a>
</h2>
<div class="section level3">
<h3 id="c-implementation-algorithm-explanation">C++ implementation algorithm explanation<a class="anchor" aria-label="anchor" href="#c-implementation-algorithm-explanation"></a>
</h3>
<p>The core of our Monte Carlo simulation is implemented in C++ for
optimal performance. Let’s break down the <code>monte_carlo</code>
function:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>Rcpp<span class="op">::</span>List monte_carlo<span class="op">(</span><span class="dt">double</span> seed_price<span class="op">,</span> <span class="dt">double</span> daily_vol<span class="op">,</span> <span class="dt">int</span> num_sims<span class="op">,</span> <span class="dt">int</span> num_days<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>    <span class="dt">int</span> total_rows <span class="op">=</span> num_sims <span class="op">*</span> num_days<span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    Rcpp<span class="op">::</span>NumericVector close<span class="op">(</span>total_rows<span class="op">);</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    Rcpp<span class="op">::</span>IntegerVector sim_idx<span class="op">(</span>total_rows<span class="op">);</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    Rcpp<span class="op">::</span>NumericVector end_price<span class="op">(</span>num_sims<span class="op">);</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    Rcpp<span class="op">::</span>IntegerVector end_idx<span class="op">(</span>num_sims<span class="op">);</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>    </span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>    <span class="dt">int</span> row_index <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> num_sims<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>        <span class="dt">double</span> current_price <span class="op">=</span> seed_price<span class="op">;</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> num_days<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>            current_price <span class="op">*=</span> <span class="op">(</span><span class="dv">1</span> <span class="op">+</span> R<span class="op">::</span>rnorm<span class="op">(</span><span class="dv">0</span><span class="op">,</span> daily_vol<span class="op">));</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>            close<span class="op">[</span>row_index<span class="op">]</span> <span class="op">=</span> current_price<span class="op">;</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>            sim_idx<span class="op">[</span>row_index<span class="op">]</span> <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>            <span class="op">++</span>row_index<span class="op">;</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>        end_price<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> current_price<span class="op">;</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>        end_idx<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>    Rcpp<span class="op">::</span>DataFrame sim_df <span class="op">=</span> Rcpp<span class="op">::</span>DataFrame<span class="op">::</span>create<span class="op">(</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a>        Rcpp<span class="op">::</span>_<span class="op">[</span><span class="st">"close"</span><span class="op">]</span> <span class="op">=</span> close<span class="op">,</span></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a>        Rcpp<span class="op">::</span>_<span class="op">[</span><span class="st">"simulation"</span><span class="op">]</span> <span class="op">=</span> sim_idx</span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>    Rcpp<span class="op">::</span>DataFrame end_df <span class="op">=</span> Rcpp<span class="op">::</span>DataFrame<span class="op">::</span>create<span class="op">(</span></span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a>        Rcpp<span class="op">::</span>_<span class="op">[</span><span class="st">"close"</span><span class="op">]</span> <span class="op">=</span> end_price<span class="op">,</span></span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a>        Rcpp<span class="op">::</span>_<span class="op">[</span><span class="st">"simulation"</span><span class="op">]</span> <span class="op">=</span> end_idx</span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a>    <span class="cf">return</span> Rcpp<span class="op">::</span>List<span class="op">::</span>create<span class="op">(</span></span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a>        Rcpp<span class="op">::</span>_<span class="op">[</span><span class="st">"simulations"</span><span class="op">]</span> <span class="op">=</span> sim_df<span class="op">,</span></span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a>        Rcpp<span class="op">::</span>_<span class="op">[</span><span class="st">"end_prices"</span><span class="op">]</span> <span class="op">=</span> end_df</span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li><p><strong>Initialisation</strong>: We create vectors to store the
simulated prices (<code>close</code>), simulation indices
(<code>sim_idx</code>), final prices (<code>end_price</code>), and final
simulation indices (<code>end_idx</code>).</p></li>
<li><p><strong>Simulation Loop</strong>: We iterate
<code>num_sims</code> times, each representing a complete price
path.</p></li>
<li><p><strong>Price Path Generation</strong>: For each simulation, we
start with the <code>seed_price</code> and generate
<code>num_days</code> of price movements.</p></li>
<li>
<p><strong>Daily Price Movement</strong>: Each day’s price is
calculated using the formula:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>current_price <span class="op">*=</span> <span class="op">(</span><span class="dv">1</span> <span class="op">+</span> R<span class="op">::</span>rnorm<span class="op">(</span><span class="dv">0</span><span class="op">,</span> daily_vol<span class="op">));</span></span></code></pre></div>
<p>This implements a geometric Brownian motion, where:</p>
<ul>
<li>
<code>R::rnorm(0, daily_vol)</code> generates a random number from a
normal distribution with mean 0 and standard deviation
<code>daily_vol</code>.</li>
<li>Multiplying by <code>(1 + ...)</code> ensures the price changes
proportionally.</li>
</ul>
</li>
<li><p><strong>Data Storage</strong>: We store each day’s price and its
corresponding simulation index.</p></li>
<li>
<p><strong>Results Compilation</strong>: After all simulations, we
create two data frames:</p>
<ul>
<li>
<code>simulations</code>: Contains all simulated prices and their
corresponding simulation indices.</li>
<li>
<code>end_prices</code>: Contains only the final price of each
simulation path.</li>
</ul>
</li>
</ol>
<div class="section level4">
<h4 id="implementation-notes">Implementation Notes<a class="anchor" aria-label="anchor" href="#implementation-notes"></a>
</h4>
<ul>
<li>We use Rcpp’s random number generator (<code>R::rnorm</code>) for
consistency with R’s random number generation.</li>
<li>The function is optimised for speed by pre-allocating memory for all
results and using as few loops as necessary for all calculations.</li>
<li>The results are returned as <code>R</code> <code>data.frames</code>
for easy integration with <code>R</code> code.</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="r6-class-implementation">R6 Class Implementation<a class="anchor" aria-label="anchor" href="#r6-class-implementation"></a>
</h3>
<p>The <code>MonteCarlo</code> <code>R6</code> class provides a
user-friendly interface for running Monte Carlo simulations and
analysing the results. Here’s an overview of its structure and
functionality:</p>
<p>The <code>MonteCarlo</code> class is organised into three main
sections:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Private fields and methods</strong>: These handle internal
data validation and preparation.</li>
<li>
<strong>Active bindings</strong>: Provide access to simulation
results.</li>
<li>
<strong>Public fields and methods</strong>: Allow users to
configure, run, and visualise simulations.</li>
</ol>
<p>Some of the key components are:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Data Preparation</strong>: The <code>prepare</code> method
calculates historical returns and volatility from the input data.</li>
<li>
<strong>Simulation Execution</strong>: The <code>carlo</code> method
calls the C++ <code>monte_carlo</code> function and processes the
results.</li>
<li>
<strong>Visualisation</strong>: Three methods
(<code>plot_prices</code>, <code>plot_distribution</code>,
<code>plot_prices_and_predictions</code>) provide different ways to
visualise the simulation results.</li>
</ol>
<p>Here’s a quick overview of the public methods available in the
<code>MonteCarlo</code> class:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co">#' Monte Carlo Simulation R6 Class</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#' @description</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#' An R6 class for performing Monte Carlo simulations on financial time series data.</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#' This class provides methods for data preparation, simulation execution, and result visualization.</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#' @details</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#' The MonteCarlo class uses historical price data to calculate volatility and perform</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#' Monte Carlo simulations for future price movements. It leverages the C++ implementation</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#' of the Monte Carlo algorithm for efficiency.</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#' @field data A data.table containing the historical price data.</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#' @field simulation_results A data.table containing the results of the Monte Carlo simulation.</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#' @field end_prices A data.table containing the final prices from each simulation path.</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#' @field log_historical Logical. Whether to use log returns for historical volatility calculation.</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#' @field number_sims Integer. The number of simulation paths to generate.</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#' @field project_days Integer. The number of days to project into the future.</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="co">#' @field start_date POSIXct. The start date for the simulation (last date of historical data).</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="co">#' @field verbose Logical. Whether to print progress messages.</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>MonteCarlo <span class="ot">&lt;-</span> R6<span class="sc">::</span><span class="fu">R6Class</span>(</span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a>    <span class="st">"MonteCarlo"</span>,</span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a>    <span class="at">private =</span> <span class="fu">list</span>(</span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a>        <span class="at">validate_data =</span> \()</span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a>        <span class="at">prepare =</span> \(<span class="at">log_historical =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a>        <span class="at">seed_price =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a>        <span class="at">daily_vol =</span> <span class="cn">NA_real_</span></span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a>    ),</span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a>    <span class="at">active =</span> <span class="fu">list</span>(</span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a>        <span class="co">#' @field results A list containing simulation results and end prices.</span></span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a>        <span class="at">results =</span> \()</span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a>    ),</span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a>    <span class="at">public =</span> <span class="fu">list</span>(</span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a>        <span class="at">data =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a>        <span class="at">simulation_results =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a>        <span class="at">end_prices =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a>        <span class="at">log_historical =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-41"><a href="#cb9-41" tabindex="-1"></a>        <span class="at">number_sims =</span> <span class="dv">1000</span>,</span>
<span id="cb9-42"><a href="#cb9-42" tabindex="-1"></a>        <span class="at">project_days =</span> <span class="dv">30</span>,</span>
<span id="cb9-43"><a href="#cb9-43" tabindex="-1"></a>        <span class="at">start_date =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-44"><a href="#cb9-44" tabindex="-1"></a>        <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-45"><a href="#cb9-45" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" tabindex="-1"></a>        <span class="co">#' @description</span></span>
<span id="cb9-47"><a href="#cb9-47" tabindex="-1"></a>        <span class="co">#' Create a new MonteCarlo object.</span></span>
<span id="cb9-48"><a href="#cb9-48" tabindex="-1"></a>        <span class="co">#' @param dt A data.table containing historical price data.</span></span>
<span id="cb9-49"><a href="#cb9-49" tabindex="-1"></a>        <span class="co">#' @param log_historical Logical. Whether to use log returns for historical volatility calculation.</span></span>
<span id="cb9-50"><a href="#cb9-50" tabindex="-1"></a>        <span class="co">#' @param number_sims Integer. The number of simulation paths to generate.</span></span>
<span id="cb9-51"><a href="#cb9-51" tabindex="-1"></a>        <span class="co">#' @param project_days Integer. The number of days to project into the future.</span></span>
<span id="cb9-52"><a href="#cb9-52" tabindex="-1"></a>        <span class="co">#' @param verbose Logical. Whether to print progress messages.</span></span>
<span id="cb9-53"><a href="#cb9-53" tabindex="-1"></a>        <span class="at">initialize =</span> \(dt, <span class="at">log_historical =</span> <span class="cn">FALSE</span>, <span class="at">number_sims =</span> <span class="dv">1000</span>, <span class="at">project_days =</span> <span class="dv">30</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-54"><a href="#cb9-54" tabindex="-1"></a></span>
<span id="cb9-55"><a href="#cb9-55" tabindex="-1"></a>        <span class="co">#' @description</span></span>
<span id="cb9-56"><a href="#cb9-56" tabindex="-1"></a>        <span class="co">#' Run the Monte Carlo simulation.</span></span>
<span id="cb9-57"><a href="#cb9-57" tabindex="-1"></a>        <span class="at">carlo =</span> \()</span>
<span id="cb9-58"><a href="#cb9-58" tabindex="-1"></a></span>
<span id="cb9-59"><a href="#cb9-59" tabindex="-1"></a>        <span class="co">#' @description</span></span>
<span id="cb9-60"><a href="#cb9-60" tabindex="-1"></a>        <span class="co">#' Plot the simulated price paths.</span></span>
<span id="cb9-61"><a href="#cb9-61" tabindex="-1"></a>        <span class="co">#' @return A ggplot object showing the simulated price paths.</span></span>
<span id="cb9-62"><a href="#cb9-62" tabindex="-1"></a>        <span class="at">plot_prices =</span> \()</span>
<span id="cb9-63"><a href="#cb9-63" tabindex="-1"></a></span>
<span id="cb9-64"><a href="#cb9-64" tabindex="-1"></a>        <span class="co">#' @description</span></span>
<span id="cb9-65"><a href="#cb9-65" tabindex="-1"></a>        <span class="co">#' Plot the distribution of final prices.</span></span>
<span id="cb9-66"><a href="#cb9-66" tabindex="-1"></a>        <span class="co">#' @return A ggplot object showing the distribution of final prices.</span></span>
<span id="cb9-67"><a href="#cb9-67" tabindex="-1"></a>        <span class="at">plot_distribution =</span> \()</span>
<span id="cb9-68"><a href="#cb9-68" tabindex="-1"></a></span>
<span id="cb9-69"><a href="#cb9-69" tabindex="-1"></a>        <span class="co">#' @description</span></span>
<span id="cb9-70"><a href="#cb9-70" tabindex="-1"></a>        <span class="co">#' Plot historical prices and simulated future prices.</span></span>
<span id="cb9-71"><a href="#cb9-71" tabindex="-1"></a>        <span class="co">#' @return A ggplot object showing historical and simulated prices.</span></span>
<span id="cb9-72"><a href="#cb9-72" tabindex="-1"></a>        <span class="at">plot_prices_and_predictions =</span> \()</span>
<span id="cb9-73"><a href="#cb9-73" tabindex="-1"></a>    )</span>
<span id="cb9-74"><a href="#cb9-74" tabindex="-1"></a>)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="performance-considerations">Performance Considerations<a class="anchor" aria-label="anchor" href="#performance-considerations"></a>
</h2>
<p>Monte Carlo simulations can be computationally intensive, especially
with a large number of simulations or complex models. Our package
addresses this by implementing the core simulation logic in
<code>C++</code> via <code>Rcpp</code>. This results in significantly
faster execution compared to pure <code>R</code> implementations.</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Monte Carlo simulations are a powerful tool in the financial
analyst’s toolkit. They allow us to model complex, real-world systems
and make probabilistic forecasts. However, they should be used
judiciously, with a clear understanding of their assumptions and
limitations.</p>
<p>Our package aims to make these sophisticated techniques accessible
and efficient, allowing analysts to focus on interpreting results rather
than implementation details.</p>
<p>Remember, while Monte Carlo simulations can provide valuable
insights, they are not crystal balls. They are tools to help inform
decision-making, not to predict the future with certainty.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://derecksnotes.com" class="external-link">Dereck Mezquita</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
